<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Daily Job Entry</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #0e1621;
  color: #e5e7eb;
  margin: 0;
  padding: 16px;
}

/* ===== TOP NAV ===== */
.top-nav {
  display: flex;
  gap: 10px;
  margin-bottom: 12px;
  justify-content: center;
}

.top-nav button {
  padding: 6px 14px;
  font-size: 14px;
  background: #003f88;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

/* ===== CARD ===== */
.container {
  background: #1b2636;
  padding: 18px;
  border-radius: 10px;
  box-shadow: 0 4px 14px rgba(0,0,0,.6);
  max-width: 520px;
  margin: auto;
}

h2 {
  text-align: center;
  color: #93c5fd;
  margin-bottom: 18px;
  font-size: 20px;
}

/* ===== FORM ===== */
.field {
  margin-bottom: 14px;
}

label {
  font-weight: bold;
  font-size: 13px;
  margin-bottom: 4px;
  display: block;
}

select, textarea {
  width: 100%;
  padding: 8px;
  font-size: 14px;
  background: #111827;
  color: #e5e7eb;
  border: 1px solid #334155;
  border-radius: 6px;
  box-sizing: border-box;
}

textarea {
  height: 110px;
  resize: none;
}

select:focus,
textarea:focus {
  outline: none;
  border-color: #60a5fa;
  box-shadow: 0 0 0 1px rgba(96,165,250,.6);
}

/* ===== BUTTON ===== */
button.submit-btn {
  width: 100%;
  padding: 12px;
  background: #003f88;
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
}

button.submit-btn:hover {
  background: #0050aa;
}

#msg {
  text-align: center;
  font-weight: bold;
  color: #22c55e;
  margin-top: 12px;
}
</style>
</head>

<body>

<!-- ===== TOP NAV ===== -->
<div class="top-nav">
  <button type="button" onclick="history.back()">‚¨Ö Back</button>
  <button type="button" onclick="location.href='https://08electricaldata.github.io/'">üè† Home</button>
</div>

<div class="container">
<h2>DAILY JOB ENTRY</h2>

<form id="jobForm" target="hiddenFrame"
action="https://docs.google.com/forms/d/e/1FAIpQLSeq4rgnqQHCZqJiwnbrdtds8Pk47ZdNlzDJL8SOeNw5z-fFTw/formResponse"
method="POST">

<!-- ===== HIDDEN AUTO FIELDS ===== -->
<input type="hidden" name="entry.2074265710" id="dateField">
<input type="hidden" name="entry.2034418039" id="mainDrive">
<input type="hidden" name="entry.273858386" id="subDrive">

<!-- ===== VISIBLE FIELDS ===== -->
<div class="field">
  <label>Nature of Job</label>
  <select name="entry.1114156376" id="natureJob" required></select>
</div>

<div class="field">
  <label>Job Details</label>
  <textarea name="entry.556400630" required></textarea>
</div>

<div class="field">
  <label>Job By</label>
  <select name="entry.972123475" required>
    <option value="">Select</option>
    <option>NALCO</option>
    <option>ANIL_AREA</option>
    <option>Nalco & ANIL</option>
    <option>Nalco & SUPPLY</option>
    <option>SUPPLY & ANIL</option>
    <option>SUPPLY</option>
    <option>MOTOR</option>
    <option>NALCO_ANIL_SUPPLY</option>
    <option>SUNIL BISWAL</option>
    <option>MAHARANA BDM</option>
  </select>
</div>

<button type="submit" class="submit-btn">SUBMIT</button>
<div id="msg"></div>

</form>

<iframe name="hiddenFrame" style="display:none"></iframe>
</div>

<script>
/* ===== AUTO DATE (ISO ‚Äì SAFE FOR SHEETS) ===== */
const today = new Date();
const yyyy = today.getFullYear();
const mm = String(today.getMonth() + 1).padStart(2, "0");
const dd = String(today.getDate()).padStart(2, "0");
document.getElementById("dateField").value = `${yyyy}-${mm}-${dd}`;

/* ===== READ ID FROM URL (FIXED) ===== */
const id = new URLSearchParams(location.search).get("id");
if (id) {
  const firstDash = id.indexOf("-");
  if (firstDash !== -1) {
    document.getElementById("mainDrive").value =
      id.substring(0, firstDash);
    document.getElementById("subDrive").value =
      id.substring(firstDash + 1);
  }
}

/* ===== LOAD NATURE OF JOB ===== */
const jsonURL =
  "https://raw.githubusercontent.com/08electricaldata/08electricaldata-json/main/dropdown/drives.json";

fetch(jsonURL)
.then(r => r.json())
.then(j => {

  const rows = j.rows;
  const natureSel = document.getElementById("natureJob");
  const set = new Set();   // 1Ô∏è‚É£ create set

  rows.forEach(r => {     // 2Ô∏è‚É£ collect values
    const val = (r[2] || "").trim();   // or r[2] if using Column C
    if (val) set.add(val);
  });

  set.forEach(v => {      // 3Ô∏è‚É£ populate dropdown
    natureSel.add(new Option(v, v));
  });

});


/* ===== SUBMIT FEEDBACK ===== */
document.getElementById("jobForm").onsubmit = () => {
  setTimeout(() => {
    document.getElementById("msg").innerText =
      "‚úÖ Submitted successfully. Pending verification.";
    jobForm.reset();
    document.getElementById("dateField").value =
      `${yyyy}-${mm}-${dd}`;
  }, 800);
};
</script>

</body>
</html>
